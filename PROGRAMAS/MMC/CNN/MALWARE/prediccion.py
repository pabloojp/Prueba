"""
Para predecir la se√±al que aparece en una imagen, tenemos que cargar el modelo despues de 20 epochs y
la imagen. Esta √∫ltima tenemos que pasarla a una imagen con tres canales  y redimensionarla a 30 x 30 pixeles.
Despues de que mi modelo prediga cual ser√≠a su etiqueta, le asignamos su nombre correspondiente del diccionario 
clases.
"""


import numpy as np 
                                         
from keras.models import load_model
from load_hijos import file_to_image


def predecir(model, nombre):

    model = load_model(model)
    
    clases = { 
        1: 'Ramnit', 
        2: 'Lollipop', 
        3: 'Kelihos_ver3', 
        4: 'Vundo', 
        5: 'Simda', 
        6: 'Tracur', 
        7: 'Kelihos_ver1', 
        8: 'Obfuscator.ACY', 
        9: 'Gatak'
    }
    
    image_path = nombre 
    image = file_to_image(image_path)
    imagen = np.array(image)

    prediction = model.predict(np.array([imagen]))  
    predicted_class = np.argmax(prediction)
    predicted_label = clases[predicted_class+1]
    
    probabilities = prediction[0]
    print(f'Clase predicha: {predicted_label}')
    
    print('Probabilidades:')
    for i, prob in enumerate(probabilities):
        print(f'{clases[i+1]}: {prob:.4f}')